<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Record Management System | Efficient Record Organization & Management</title>
    <meta name="description" content="Streamline your record management with our efficient system. Organize, track, and manage all your records in one place with our user-friendly interface.">
    <meta name="keywords" content="record management, data organization, record tracking, database management, record system">
    <meta name="author" content="Record Management System">
    
    <!-- Open Graph / Social Media Meta Tags -->
    <meta property="og:title" content="Record Management System | Efficient Record Organization">
    <meta property="og:description" content="Streamline your record management with our efficient system. Organize, track, and manage all your records in one place.">
    <meta property="og:type" content="website">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://yourdomain.com/records">
    
    <!-- Structured Data -->
    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebApplication",
      "name": "Record Management System",
      "description": "Efficient record management and organization system",
      "url": "https://yourdomain.com",
      "applicationCategory": "BusinessApplication",
      "operatingSystem": "Web-based",
      "offers": {
        "@type": "Offer",
        "price": "0",
        "priceCurrency": "USD"
      }
    }
    </script>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <!-- Skip to main content for accessibility -->
    <a href="#main-content" class="skip-link visually-hidden-focusable">Skip to main content</a>
    
    <div class="container">
        <!-- Combined Header Section -->
        <header class="header-section" role="banner">
            <div class="header-content">
                <div class="title-section">
                    <h1 class="main-title">Record Management System</h1>
                    <p class="subtitle">Efficiently manage and organize all your records with our comprehensive solution</p>
                </div>
                <div class="stats-section">
                    <div class="count-card">
                        <div class="count-icon" aria-hidden="true">üìä</div>
                        <div class="count-info">
                            <div class="count-label">Total Records</div>
                            <div class="count-number">{{ records|length if records else 0 }}</div>
                        </div>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main id="main-content" role="main">
            <!-- Records Table -->
            <section class="records-table-container" aria-labelledby="records-heading">
                {% if records %}
                <div class="table-header">
                    <h2 id="records-heading">All Records</h2>
                    <a href="/create" class="btn btn-create">
                        Add New Record
                    </a>
                </div>
                <div class="table-responsive">
                    <table class="table table-hover" aria-describedby="records-heading">
                        <caption class="visually-hidden">List of all records in the system with ID, name, email, phone, status, creation date and actions</caption>
                        <thead>
                            <tr>
                                <th scope="col">ID</th>
                                <th scope="col">Full Name</th>
                                <th scope="col">Email</th>
                                <th scope="col">Phone</th>
                                <th scope="col">Status</th>
                                <th scope="col">Created At</th>
                                <th scope="col">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for record in records %}
                            <tr data-record-id="{{ record.id }}"
                                data-record-name="{{ record.name }}"
                                data-record-email="{{ record.email }}"
                                data-record-phone="{{ record.phone or 'N/A' }}"
                                data-record-created="{{ record.created_at.strftime('%Y-%m-%d %H:%M') }}"
                                data-record-updated="{{ record.updated_at.strftime('%Y-%m-%d %H:%M') if record.updated_at else 'N/A' }}"
                                data-record-description="{{ record.description or '' }}"
                                data-record-status="{{ record.status }}">
                                <td class="record-id">#{{ record.id }}</td>
                                <td class="record-name">{{ record.name }}</td>
                                <td class="record-email">{{ record.email }}</td>
                                <td class="record-phone">{{ record.phone or 'N/A' }}</td>
                                <td class="record-status">
                                    <span class="status-badge status-{{ record.status }}">
                                        {{ record.status|title }}
                                    </span>
                                </td>
                                <td class="record-date">{{ record.created_at.strftime('%Y-%m-%d %H:%M') }}</td>
                                <td class="action-buttons">
                                    <button class="btn btn-view view-record-btn" aria-label="View details for {{ record.name }}">View</button>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                <!-- Empty State -->
                <div class="empty-state text-center" role="status" aria-live="polite">
                    <div class="empty-icon" aria-hidden="true">üìù</div>
                    <h2>No Records Found</h2>
                    <p>Get started by creating your first record in the system.</p>
                    <a href="/create" class="btn btn-primary">
                        Create First Record
                    </a>
                </div>
                {% endif %}
            </section>
        </main>
    </div>

    <!-- View Record Modal -->
    <div class="modal fade" id="viewRecordModal" tabindex="-1" aria-labelledby="viewRecordModalLabel" aria-hidden="true" role="dialog">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title h5" id="viewRecordModalLabel">Record Details</h2>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="record-details">
                        <div class="detail-item">
                            <label>Record ID:</label>
                            <span id="modal-record-id">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Full Name:</label>
                            <span id="modal-record-name">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Email Address:</label>
                            <span id="modal-record-email">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Phone Number:</label>
                            <span id="modal-record-phone">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Description:</label>
                            <span id="modal-record-description">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Status:</label>
                            <span id="modal-record-status">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Created At:</label>
                            <span id="modal-record-created">-</span>
                        </div>
                        <div class="detail-item">
                            <label>Last Updated:</label>
                            <span id="modal-record-updated">-</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="modal-footer-buttons">
                        <a href="#" class="btn btn-edit" id="modal-edit-btn">Edit Record</a>
                        <button type="button" class="btn btn-danger" id="modal-delete-btn">Delete Record</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true" role="dialog">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h2 class="modal-title h5" id="deleteModalLabel">Confirm Deletion</h2>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="delete-warning">
                        <div class="warning-icon" aria-hidden="true">‚ö†Ô∏è</div>
                        <h3>Are you sure you want to delete this record?</h3>
                        <p>This action cannot be undone. The following record will be permanently removed from the system:</p>
                        <div class="record-to-delete">
                            <strong>Record ID:</strong> <span id="delete-record-id">-</span><br>
                            <strong>Name:</strong> <span id="delete-record-name">-</span><br>
                            <strong>Email:</strong> <span id="delete-record-email">-</span>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="modal-footer-buttons">
                        <button type="button" class="btn btn-danger" id="confirm-delete-btn">Delete Record</button>
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Wait for the DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            let currentRecordId = null;
            
            // Get all view buttons
            var viewButtons = document.querySelectorAll('.view-record-btn');
            
            // Add click event to each view button
            viewButtons.forEach(function(button) {
                button.addEventListener('click', function() {
                    // Get the parent row
                    var row = this.closest('tr');
                    
                    // Get record data from data attributes
                    var recordId = row.getAttribute('data-record-id');
                    var recordName = row.getAttribute('data-record-name');
                    var recordEmail = row.getAttribute('data-record-email');
                    var recordPhone = row.getAttribute('data-record-phone');
                    var recordDescription = row.getAttribute('data-record-description');
                    var recordStatus = row.getAttribute('data-record-status');
                    var recordCreated = row.getAttribute('data-record-created');
                    var recordUpdated = row.getAttribute('data-record-updated');
                    
                    // Store current record ID for deletion
                    currentRecordId = recordId;
                    
                    // Populate modal with record data
                    document.getElementById('modal-record-id').textContent = '#' + recordId;
                    document.getElementById('modal-record-name').textContent = recordName;
                    document.getElementById('modal-record-email').textContent = recordEmail;
                    document.getElementById('modal-record-phone').textContent = recordPhone;
                    document.getElementById('modal-record-description').textContent = recordDescription || 'No description';
                    document.getElementById('modal-record-status').textContent = recordStatus.charAt(0).toUpperCase() + recordStatus.slice(1);
                    document.getElementById('modal-record-created').textContent = recordCreated;
                    document.getElementById('modal-record-updated').textContent = recordUpdated;
                    
                    // Set edit button href
                    document.getElementById('modal-edit-btn').href = '/edit/' + recordId;
                    
                    // Set delete button action to show delete confirmation modal
                    document.getElementById('modal-delete-btn').onclick = function() {
                        // Populate delete modal
                        document.getElementById('delete-record-id').textContent = '#' + recordId;
                        document.getElementById('delete-record-name').textContent = recordName;
                        document.getElementById('delete-record-email').textContent = recordEmail;
                        
                        // Hide view modal and show delete modal
                        var viewModal = bootstrap.Modal.getInstance(document.getElementById('viewRecordModal'));
                        viewModal.hide();
                        
                        var deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
                        deleteModal.show();
                    };
                    
                    // Show the view modal
                    var viewModal = new bootstrap.Modal(document.getElementById('viewRecordModal'));
                    viewModal.show();
                });
            });

            // Confirm delete button action
            document.getElementById('confirm-delete-btn').onclick = function() {
                if (currentRecordId) {
                    window.location.href = '/delete/' + currentRecordId;
                }
            };

            // Add loading state to forms if needed
            var forms = document.querySelectorAll('form');
            forms.forEach(function(form) {
                form.addEventListener('submit', function() {
                    var submitBtn = this.querySelector('button[type="submit"]');
                    if (submitBtn) {
                        submitBtn.disabled = true;
                        submitBtn.innerHTML = '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> Processing...';
                    }
                });
            });
        });

        // Function to show success messages
        function showSuccessMessage(message) {
            // Create toast notification
            const toast = document.createElement('div');
            toast.className = 'alert alert-success alert-dismissible fade show position-fixed top-0 end-0 m-3';
            toast.style.zIndex = '1060';
            toast.setAttribute('role', 'alert');
            toast.setAttribute('aria-live', 'polite');
            toast.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close notification"></button>
            `;
            document.body.appendChild(toast);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 5000);
        }

        // Check for URL parameters to show messages
        document.addEventListener('DOMContentLoaded', function() {
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('success') === 'true') {
                showSuccessMessage('Operation completed successfully!');
            }
        });
    </script>
</body>
</html>